#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

DEFAULT_INPUT_DIR="$REPO_ROOT/input"
DEFAULT_OUTPUT_DIR="$REPO_ROOT/output"

########################################
# CONFIGURA√á√ÉO PRINCIPAL
########################################

# Diret√≥rio alvo para escanear
TARGET_DIR="${TARGET_DIR:-$DEFAULT_INPUT_DIR}"

# Diret√≥rio de sa√≠da para os arquivos gerados
OUTPUT_DIR="${OUTPUT_DIR:-$DEFAULT_OUTPUT_DIR}"

# Sufixo do arquivo de sa√≠da
OUTPUT_FILE_SUFFIX="${OUTPUT_FILE_SUFFIX:-_project_code.txt}"

# Tamanho m√°ximo por arquivo (em bytes) - padr√£o 2MB
MAX_SIZE_BYTES="${MAX_SIZE_BYTES:-2097152}"

########################################
# LISTAS DE EXCLUS√ÉO
########################################

# Lista de ARQUIVOS a ignorar (separados por |)
# Voc√™ pode adicionar mais arquivos aqui ou via vari√°vel de ambiente IGNORE_FILES_EXTRA
IGNORE_FILES_BASE='.DS_Store|Thumbs.db|.env|.env.local|.env.production|.env.development|*.key|*.pem|*.p12|*.pfx|*.log|*.pid|*.seed|*.sqlite|*.sqlite3|*.db|desktop.ini|*.swp|*.swo|*~|.~lock.*|._*'
IGNORE_FILES_EXTRA="${IGNORE_FILES_EXTRA:-}"

# Lista de DIRET√ìRIOS a ignorar (separados por |)
# Diret√≥rios padr√£o de build, depend√™ncias e cache
IGNORE_DIRS_BASE='node_modules|dist|build|target|bin|.git|.next|coverage|.turbo|.cache|.expo|.gradle|.mvn|.settings|Pods|DerivedData|.idea|.vscode|out|tmp|.parcel-cache|.sass-cache|.nuxt|.svelte-kit|__pycache__|.pytest_cache|cmake-build-debug|cmake-build-release|CMakeFiles|.dart_tool|.pub-cache|.pub|.android|.ios|.macos|.windows|.linux|.metadata|.packages|.flutter-plugins|.flutter-plugins-dependencies|vendor|bower_components|jspm_packages|web_modules|.yarn|.pnp.*'
IGNORE_DIRS_EXTRA="${IGNORE_DIRS_EXTRA:-}"

# Lista de CAMINHOS RELATIVOS de pastas a ignorar
# √ötil para ignorar bibliotecas espec√≠ficas ou subpastas profundas
# Exemplo: "src/vendor/large-library|assets/generated"
IGNORE_PATHS="${IGNORE_PATHS:-}"

# Lista de CAMINHOS ABSOLUTOS de pastas a ignorar
# √ötil para ignorar diret√≥rios espec√≠ficos com caminho completo
# Exemplo: "/home/user/project/vendor/huge-lib|/opt/shared/legacy"
IGNORE_ABSOLUTE_PATHS="${IGNORE_ABSOLUTE_PATHS:-}"

# Combina as listas com extras (se fornecidas)
IGNORE_FILES_PATTERN="${IGNORE_FILES_BASE}${IGNORE_FILES_EXTRA:+|$IGNORE_FILES_EXTRA}"
IGNORE_DIRS_PATTERN="${IGNORE_DIRS_BASE}${IGNORE_DIRS_EXTRA:+|$IGNORE_DIRS_EXTRA}"

########################################
# EXTENS√ïES E ARQUIVOS DE CONFIGURA√á√ÉO
########################################

# Extens√µes de c√≥digo a incluir
CODE_EXTS=(
    # C/C++
    "c" "cpp" "cc" "cxx" "c++" "h" "hpp" "hxx" "h++" "hh"
    
    # Objective-C / Swift
    "m" "mm" "swift"
    
    # JavaScript / TypeScript
    "js" "jsx" "mjs" "cjs" "ts" "tsx" "mts" "cts"
    
    # Java / Kotlin
    "java" "kt" "kts"
    
    # Dart / Flutter
    "dart"
    
    # HTML/CSS
    "html" "htm" "css" "scss" "sass" "less"
    
    # Markdown
    "md" "mdx" "markdown"
    
    # Python
    "py" "pyx" "pyi"
    
    # Rust
    "rs"
    
    # Go
    "go"
    
    # Ruby
    "rb" "erb"
    
    # PHP
    "php"
    
    # Shell scripts
    "sh" "bash" "zsh" "fish"
    
    # Metal shaders
    "metal"
)

# Arquivos de configura√ß√£o importantes
CONFIG_FILES=(
    # Node/TS/Bundlers
    "package.json" "package-lock.json" "pnpm-lock.yaml" "yarn.lock" "bun.lockb"
    "tsconfig.json" "tsconfig.*.json" "jsconfig.json"
    "vite.config.*" "webpack.config.*" "rollup.config.*"
    "babel.config.*" ".babelrc*"
    "next.config.*" ".eslintrc*" ".prettierrc*" "prettier.config.*"
    ".npmrc" ".nvmrc" ".node-version"
    
    # Java/Maven/Gradle
    "pom.xml" "build.gradle*" "settings.gradle*" "gradle.properties"
    "gradlew" "gradlew.bat" "mvnw" "mvnw.cmd"
    ".classpath" ".project"
    
    # Spring Boot
    "application*.properties" "application*.yml" "application*.yaml"
    "bootstrap*.properties" "bootstrap*.yml" "bootstrap*.yaml"
    
    # Front-end
    "postcss.config.*" "tailwind.config.*" "stylelint.config.*" ".stylelintrc*"
    
    # C/C++ Build Files
    "Makefile" "makefile" "GNUmakefile" "CMakeLists.txt" "*.cmake"
    "configure" "configure.ac" "configure.in"
    "*.pro" "*.pri"  # Qt project files
    "meson.build" "meson_options.txt"
    "BUILD" "BUILD.bazel" "WORKSPACE"  # Bazel
    
    # Flutter
    "pubspec.yaml" "pubspec.lock" "pubspec_overrides.yaml"
    ".metadata" ".packages" ".dart_tool/package_config.json"
    "analysis_options.yaml" "*.iml"
    "android/local.properties" "ios/Podfile*"
    
    # Documentation & Others
    "README*" "LICENSE*" ".gitignore" ".gitattributes"
    "Dockerfile" "docker-compose.yml" "docker-compose.yaml"
    ".dockerignore" "Procfile" "requirements.txt" "Gemfile" "Gemfile.lock"
    "Cargo.toml" "Cargo.lock" "go.mod" "go.sum"
    
    # Xcode
    "*.xcodeproj" "*.xcworkspace" "*.xcscheme" "*.pbxproj"
    "Info.plist" "Entitlements.plist"
)

########################################
# FUN√á√ïES AUXILIARES
########################################

# Fun√ß√£o: obt√©m tamanho do arquivo de forma port√°til (macOS/Linux)
get_size_bytes() {
    local f="$1"
    if size=$(stat -f%z "$f" 2>/dev/null); then
        echo "$size"
    else
        stat -c%s "$f" 2>/dev/null || echo "0"
    fi
}

# Fun√ß√£o: formata bytes para exibi√ß√£o leg√≠vel
format_bytes() {
    local bytes=$1
    if [ $bytes -lt 1024 ]; then
        echo "${bytes}B"
    elif [ $bytes -lt 1048576 ]; then
        echo "$((bytes / 1024))KB"
    else
        echo "$((bytes / 1048576))MB"
    fi
}

# Fun√ß√£o: verifica se um arquivo deve ser ignorado
should_ignore_file() {
    local filepath="$1"
    local filename=$(basename "$filepath")
    
    # Sempre ignorar .DS_Store
    if [[ "$filename" == ".DS_Store" ]]; then
        return 0
    fi
    
    # Converte pattern em array
    IFS='|' read -ra IGNORE_FILES_ARRAY <<< "$IGNORE_FILES_PATTERN"
    
    for pattern in "${IGNORE_FILES_ARRAY[@]}"; do
        # Remove espa√ßos em branco
        pattern=$(echo "$pattern" | xargs)
        
        # Verifica se o pattern corresponde ao nome do arquivo
        if [[ "$filename" == $pattern ]]; then
            return 0  # Deve ignorar
        fi
    done
    
    return 1  # N√£o deve ignorar
}

# Fun√ß√£o: verifica se um caminho deve ser ignorado
should_ignore_path() {
    local filepath="$1"
    local project_dir="$2"
    
    # Obt√©m o caminho absoluto do arquivo
    local absolute_filepath="$(realpath "$filepath" 2>/dev/null || echo "$filepath")"
    
    # Remove o diret√≥rio do projeto do caminho para compara√ß√£o relativa
    local relative_path="${filepath#$project_dir/}"
    
    # Verifica caminhos ABSOLUTOS espec√≠ficos
    if [ -n "$IGNORE_ABSOLUTE_PATHS" ]; then
        IFS='|' read -ra IGNORE_ABS_ARRAY <<< "$IGNORE_ABSOLUTE_PATHS"
        for ignore_path in "${IGNORE_ABS_ARRAY[@]}"; do
            ignore_path=$(echo "$ignore_path" | xargs)
            # Verifica se o caminho absoluto come√ßa com o caminho a ignorar
            if [[ "$absolute_filepath" == "$ignore_path"* ]]; then
                return 0  # Deve ignorar
            fi
        done
    fi
    
    # Verifica caminhos RELATIVOS espec√≠ficos
    if [ -n "$IGNORE_PATHS" ]; then
        IFS='|' read -ra IGNORE_PATHS_ARRAY <<< "$IGNORE_PATHS"
        for ignore_path in "${IGNORE_PATHS_ARRAY[@]}"; do
            ignore_path=$(echo "$ignore_path" | xargs)
            # Verifica se o caminho relativo cont√©m o padr√£o
            if [[ "$relative_path" == *"$ignore_path"* ]]; then
                return 0  # Deve ignorar
            fi
        done
    fi
    
    return 1  # N√£o deve ignorar
}

########################################
# FUN√á√ÉO PRINCIPAL DE PROCESSAMENTO
########################################

process_project() {
    local project_dir="$1"
    local project_name="$2"
    local output_file="$3"
    
    echo "  üìÅ Processando: $project_name"
    
    # Limpa/cria arquivo de sa√≠da
    : > "$output_file"
    
    # Estat√≠sticas
    local file_count=0
    local skipped_count=0
    local total_size=0
    
    ########################################
    # CABE√áALHO E ESTRUTURA DE DIRET√ìRIOS
    ########################################
    {
        echo "‚ïî=‚ïó"
        echo "‚ïë PROJETO: $project_name"
        echo "‚ïë Data de gera√ß√£o: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "‚ïö=‚ïù"
        echo
        echo "üìÇ ESTRUTURA DE DIRET√ìRIOS"
        echo "="
        
        if command -v tree >/dev/null 2>&1; then
            # Usando tree, ignorando diret√≥rios pesados e arquivos .DS_Store
            tree -a -I "$IGNORE_DIRS_PATTERN|.DS_Store|._*" "$project_dir" 2>/dev/null || echo "Erro ao gerar √°rvore de diret√≥rios"
        else
            # Fallback com find
            IGN_LIST=(${IGNORE_DIRS_PATTERN//|/ })
            # head truncates to 500 lines and can raise SIGPIPE under pipefail, so ignore that non-zero exit.
            find "$project_dir" \
                \( -type d \( $(printf -- '-name %q -o ' "${IGN_LIST[@]}") -false \) -prune \) -o \
                \( -type f -name '.DS_Store' -prune \) -o \
                \( -type f -name '._*' -prune \) -o \
                -print 2>/dev/null | grep -v '\.DS_Store' | grep -v '\._' | sed "s|$project_dir|.|" | head -500 || true
        fi
        echo
        echo
    } >> "$output_file"
    
    ########################################
    # MONTA EXPRESS√ïES PARA O FIND
    ########################################
    
    # Express√£o para arquivos de c√≥digo
    code_name_expr=()
    for ext in "${CODE_EXTS[@]}"; do
        code_name_expr+=( -name "*.${ext}" -o )
    done
    
    # Express√£o para arquivos de configura√ß√£o
    for cfg in "${CONFIG_FILES[@]}"; do
        code_name_expr+=( -name "$cfg" -o )
    done
    
    # Remove √∫ltimo "-o"
    if [ ${#code_name_expr[@]} -gt 0 ]; then
        unset 'code_name_expr[${#code_name_expr[@]}-1]'
    fi
    
    ########################################
    # COLETA E PROCESSA ARQUIVOS
    ########################################
    
    {
        echo "üìÑ CONTE√öDO DOS ARQUIVOS"
        echo "="
        echo
    } >> "$output_file"
    
    IGN_LIST=(${IGNORE_DIRS_PATTERN//|/ })
    
    # Debug: conta total de arquivos que ser√£o processados
    local total_files=$(find "$project_dir" \
        \( -type d \( $(printf -- '-name %q -o ' "${IGN_LIST[@]}") -false \) -prune \) -o \
        -type f \( "${code_name_expr[@]}" \) -print 2>/dev/null | wc -l)
    
    echo "    üìä Total de arquivos encontrados: $total_files"
    
    find "$project_dir" \
        \( -type d \( $(printf -- '-name %q -o ' "${IGN_LIST[@]}") -false \) -prune \) -o \
        -type f \( "${code_name_expr[@]}" \) -print0 2>/dev/null \
        | sort -z \
        | while IFS= read -r -d '' filepath; do
            
            # Caminho relativo
            RELATIVE_PATH="./${filepath#$project_dir/}"
            
            # Verifica se o arquivo deve ser ignorado
            if should_ignore_file "$filepath"; then
                ((++skipped_count))
                continue
            fi
            
            # Verifica se o caminho deve ser ignorado
            if should_ignore_path "$filepath" "$project_dir"; then
                ((++skipped_count))
                continue
            fi
            
            # Obt√©m tamanho do arquivo
            SIZE_BYTES="$(get_size_bytes "$filepath")"
            SIZE_FORMATTED="$(format_bytes $SIZE_BYTES)"
            
            # Verifica limite de tamanho
            if [ "$SIZE_BYTES" -gt "$MAX_SIZE_BYTES" ]; then
                {
                    echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                    echo "‚îÇ üìÑ $RELATIVE_PATH"
                    echo "‚îÇ ‚ö†Ô∏è  IGNORADO: Arquivo muito grande ($SIZE_FORMATTED > $(format_bytes $MAX_SIZE_BYTES))"
                    echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                    echo
                } >> "$output_file"
                ((++skipped_count))
                continue
            fi
            
            # Adiciona conte√∫do do arquivo
            {
                echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                echo "‚îÇ üìÑ $RELATIVE_PATH"
                echo "‚îÇ üìä Tamanho: $SIZE_FORMATTED"
                echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                
                # Verifica se √© arquivo texto
                if file "$filepath" 2>/dev/null | grep -q "text\|ASCII\|UTF"; then
                    # Remove CR e adiciona n√∫meros de linha
                    tr -d '\r' < "$filepath" 2>/dev/null | nl -ba -w4 -s' ‚îÇ ' || echo "‚îÇ [Erro ao ler arquivo]"
                else
                    echo "‚îÇ [Arquivo bin√°rio - conte√∫do omitido]"
                fi
                
                echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                echo
            } >> "$output_file"
            
            ((++file_count))
            total_size=$((total_size + SIZE_BYTES))
        done
    
    # Adiciona sum√°rio ao final do arquivo
    {
        echo
        # echo "="
        # echo "üìä SUM√ÅRIO"
        # echo "="
        # echo "  ‚úÖ Arquivos processados: $file_count"
        # echo "  ‚è≠Ô∏è  Arquivos ignorados: $skipped_count"
        # echo "  üíæ Tamanho total processado: $(format_bytes $total_size)"
        # echo "="
    } >> "$output_file"
    
    echo "    ‚úÖ Arquivos processados: $file_count"
    echo "    ‚è≠Ô∏è  Arquivos ignorados: $skipped_count"
    echo "    üíæ Tamanho total: $(format_bytes $total_size)"
}

########################################
# SCRIPT PRINCIPAL
########################################

if [ -t 1 ] && [ -n "${TERM:-}" ] && command -v clear >/dev/null 2>&1; then
    clear
fi
echo "‚ïî=‚ïó"
echo "‚ïë           SCANNER DE PROJETOS DE C√ìDIGO                   ‚ïë"
echo "‚ïö=‚ïù"
echo

# Verifica exist√™ncia do diret√≥rio de destino
if [ ! -d "$TARGET_DIR" ]; then
    if [ "$TARGET_DIR" = "$DEFAULT_INPUT_DIR" ]; then
        mkdir -p "$TARGET_DIR"
        echo "‚ÑπÔ∏è  O diret√≥rio padr√£o de entrada foi criado em: $TARGET_DIR"
        echo "   Adicione os projetos que deseja analisar dentro desse diret√≥rio e execute o script novamente."
        exit 0
    fi

    echo "‚ùå Erro: O diret√≥rio de destino n√£o foi encontrado em: $TARGET_DIR" >&2
    exit 1
fi

# Cria diret√≥rio de sa√≠da
mkdir -p "$OUTPUT_DIR"

echo "üìç Configura√ß√µes:"
echo "   ‚Ä¢ Diret√≥rio alvo: $TARGET_DIR"
echo "   ‚Ä¢ Diret√≥rio de sa√≠da: $OUTPUT_DIR"
echo "   ‚Ä¢ Tamanho m√°ximo por arquivo: $(format_bytes $MAX_SIZE_BYTES)"
echo "   ‚Ä¢ Arquivos ignorados: $(echo "$IGNORE_FILES_PATTERN" | tr '|' ', ')"
echo "   ‚Ä¢ Diret√≥rios ignorados: $(echo "$IGNORE_DIRS_PATTERN" | tr '|' ', ')"
[ -n "$IGNORE_PATHS" ] && echo "   ‚Ä¢ Caminhos relativos ignorados: $(echo "$IGNORE_PATHS" | tr '|' ', ')"
[ -n "$IGNORE_ABSOLUTE_PATHS" ] && echo "   ‚Ä¢ Caminhos absolutos ignorados: $(echo "$IGNORE_ABSOLUTE_PATHS" | tr '|' ', ')"
echo
echo "="
echo "üöÄ Iniciando varredura..."
echo "="
echo

# Processa cada subdiret√≥rio do TARGET_DIR como um projeto separado
project_count=0

for project_path in "$TARGET_DIR"/*; do
    if [ -d "$project_path" ]; then
        project_name=$(basename "$project_path")
        output_file="$OUTPUT_DIR/${project_name}${OUTPUT_FILE_SUFFIX}"
        
        echo "[Projeto $((++project_count))]"
        process_project "$project_path" "$project_name" "$output_file"
        echo "  üíæ Salvo em: $output_file"
        echo
    fi
done

# Se n√£o houver subdiret√≥rios, processa o TARGET_DIR inteiro
if [ $project_count -eq 0 ]; then
    echo "‚ÑπÔ∏è  Nenhum subdiret√≥rio encontrado. Processando $TARGET_DIR como projeto √∫nico..."
    echo
    
    project_name=$(basename "$TARGET_DIR")
    output_file="$OUTPUT_DIR/${project_name}${OUTPUT_FILE_SUFFIX}"
    
    process_project "$TARGET_DIR" "$project_name" "$output_file"
    echo "  üíæ Salvo em: $output_file"
fi

echo
echo "="
echo "‚ú® CONCLU√çDO!"
echo "="
echo "  üìä Total de projetos processados: $project_count"
echo "  üìÇ Arquivos gerados em: $OUTPUT_DIR"
echo "="
echo

# Lista os arquivos gerados
echo "üìã Arquivos gerados:"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
ls -lh "$OUTPUT_DIR"/*${OUTPUT_FILE_SUFFIX} 2>/dev/null || echo "  ‚ö†Ô∏è  Nenhum arquivo gerado."
echo

# Mensagem de uso das vari√°veis de ambiente
echo "üí° Dica: Voc√™ pode personalizar o comportamento usando vari√°veis de ambiente:"
echo "   ‚Ä¢ TARGET_DIR - Diret√≥rio a escanear"
echo "   ‚Ä¢ OUTPUT_DIR - Diret√≥rio de sa√≠da"
echo "   ‚Ä¢ OUTPUT_FILE_SUFFIX - Sufixo dos arquivos"
echo "   ‚Ä¢ MAX_SIZE_BYTES - Tamanho m√°ximo por arquivo"
echo "   ‚Ä¢ IGNORE_FILES_EXTRA - Arquivos adicionais a ignorar"
echo "   ‚Ä¢ IGNORE_DIRS_EXTRA - Diret√≥rios adicionais a ignorar"
echo "   ‚Ä¢ IGNORE_PATHS - Caminhos relativos espec√≠ficos a ignorar"
echo "   ‚Ä¢ IGNORE_ABSOLUTE_PATHS - Caminhos absolutos espec√≠ficos a ignorar"
echo
echo "üìå EXEMPLOS DE USO:"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo
echo "1Ô∏è‚É£  Ignorar caminhos ABSOLUTOS:"
echo '   IGNORE_ABSOLUTE_PATHS="$PWD/input/vendor/symfony|$PWD/input/libs/huge" ./$(basename $0)'
echo
echo "2Ô∏è‚É£  Ignorar caminhos RELATIVOS (dentro do projeto):"
echo '   IGNORE_PATHS="src/vendor/large-lib|tests/fixtures/big-data" ./$(basename $0)'
echo
echo "3Ô∏è‚É£  Usar ambos simultaneamente:"
echo '   IGNORE_ABSOLUTE_PATHS="$PWD/input/legacy" \'
echo '   IGNORE_PATHS="vendor/old-packages|cache/temp" \'
echo '   ./$(basename $0)'
echo
echo "4Ô∏è‚É£  Exemplo completo:"
echo '   export TARGET_DIR="./custom-input"'
echo '   export IGNORE_ABSOLUTE_PATHS="$PWD/custom-input/huge-library"'
echo '   export IGNORE_PATHS="frontend/build|backend/vendor/aws-sdk"'
echo '   export IGNORE_DIRS_EXTRA="backup|legacy"'
echo '   export IGNORE_FILES_EXTRA="*.backup|*.tmp"'
echo '   ./$(basename $0)'
echo
